<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>AI Pronunciation Checker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<style>
body {
font-family: Arial, sans-serif;
background: #f5f7fa;
padding: 20px;
max-width: 700px;
margin: auto;
}
h1 { text-align: center; }
button {
padding: 12px 18px;
margin: 5px 0;
font-size: 16px;
cursor: pointer;
}
textarea {
width: 100%;
height: 120px;
margin-top: 10px;
padding: 10px;
font-size: 15px;
}
#aiResult {
margin-top: 15px;
padding: 12px;
background: #fff;
border-left: 4px solid #4caf50;
min-height: 40px;
}
</style>
</head>
<body>

<h1>AI Pronunciation Checker</h1>

<button id="recordBtn">üéôÔ∏è Start Recording</button>
<button id="analyzeBtn">ü§ñ Analyze with AI</button>

<textarea id="transcript" placeholder="Your speech transcript will appear here..."></textarea>

<div id="aiResult">AI feedback will appear here.</div>

<script>
// ================================
// SPEECH RECOGNITION (STABLE)
// ================================

const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

if (!SpeechRecognition) {
alert("Speech Recognition not supported in this browser. Use Chrome.");
}

const recognition = new SpeechRecognition();
recognition.lang = "en-US";
recognition.interimResults = false;
recognition.continuous = false;

const recordBtn = document.getElementById("recordBtn");
const analyzeBtn = document.getElementById("analyzeBtn");
const transcriptArea = document.getElementById("transcript");
const aiResult = document.getElementById("aiResult");

recordBtn.onclick = () => {
transcriptArea.value = "";
aiResult.innerText = "Recording...";
recordBtn.disabled = true;
recognition.start();
};

recognition.onresult = (event) => {
const text = event.results[0][0].transcript;
transcriptArea.value = text;
aiResult.innerText = "Recording finished. Ready for AI analysis.";
};

recognition.onerror = (e) => {
aiResult.innerText = "Mic error: " + e.error;
recordBtn.disabled = false;
};

recognition.onend = () => {
recordBtn.disabled = false;
};

// ================================
// AI ANALYSIS (SEPARATE & SAFE)
// ================================

analyzeBtn.onclick = async () => {
const text = transcriptArea.value.trim();

if (!text) {
alert("Please record your voice first.");
return;
}

aiResult.innerText = "Analyzing with AI...";

try {
const response = await fetch(
"https://weathered-poetry-d2e2.sahiranur029.workers.dev/",
{
method: "POST",
headers: { "Content-Type": "application/json" },
body: JSON.stringify({ transcript: text })
}
);

const data = await response.json();
aiResult.innerText = data.feedback || "No feedback from AI.";

} catch (error) {
console.error(error);
aiResult.innerText = "AI error, but recording still works.";
}
};
</script>

</body>
</html>

