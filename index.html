<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <title>AI Pronunciation Checker</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>

    body {

      font-family: Arial, sans-serif;

      background: #f6f8fa;

      padding: 40px;

    }

    .container {

      max-width: 600px;

      margin: auto;

      background: white;

      padding: 30px;

      border-radius: 10px;

      box-shadow: 0 0 10px rgba(0,0,0,0.1);

    }

    textarea {

      width: 100%;

      height: 120px;

      margin-top: 10px;

      padding: 10px;

    }

    button {

      margin-top: 15px;

      padding: 10px 15px;

      font-size: 16px;

      cursor: pointer;

    }

    #aiResult {

      margin-top: 20px;

      padding: 10px;

      background: #eef2ff;

      border-radius: 5px;

      min-height: 40px;

    }

  </style>

</head>

<body>



<div class="container">

  <h2>AI Pronunciation Checker</h2>



  <button id="recordBtn">üé§ Start Recording</button>

  <button id="stopBtn" disabled>‚èπ Stop Recording</button>



  <textarea id="transcript" placeholder="Your speech text will appear here..."></textarea>



  <button id="analyzeBtn">ü§ñ Analyze with AI</button>



  <div id="aiResult"></div>

</div>



<script>

  let recognition;

  let finalTranscript = "";



  const recordBtn = document.getElementById("recordBtn");

  const stopBtn = document.getElementById("stopBtn");

  const transcriptBox = document.getElementById("transcript");

  const aiResult = document.getElementById("aiResult");



  if (!("webkitSpeechRecognition" in window)) {

    alert("Use Google Chrome. Speech Recognition not supported.");

  } else {

    recognition = new webkitSpeechRecognition();

    recognition.lang = "en-US";

    recognition.continuous = true;

    recognition.interimResults = false;



    recognition.onresult = (event) => {

      for (let i = event.resultIndex; i < event.results.length; i++) {

        if (event.results[i].isFinal) {

          finalTranscript += event.results[i][0].transcript + " ";

        }

      }

      transcriptBox.value = finalTranscript.trim();

    };



    recognition.onerror = (e) => {

      console.error("Speech error:", e);

      alert("Speech recognition error.");

    };

  }



  recordBtn.onclick = () => {

    finalTranscript = "";

    transcriptBox.value = "";

    recognition.start();

    recordBtn.disabled = true;

    stopBtn.disabled = false;

  };



  stopBtn.onclick = () => {

    recognition.stop();

    recordBtn.disabled = false;

    stopBtn.disabled = true;

  };



  document.getElementById("analyzeBtn").onclick = async () => {

    const text = transcriptBox.value.trim();



    console.log("TEXT SENT:", text);



    if (!text) {

      alert("No text received. Please record first.");

      return;

    }



    aiResult.textContent = "Analyzing with AI...";



    try {

      const response = await fetch(

        "https://weathered-poetry-d2e2.sahiranu029.workers.dev",

        {

          method: "POST",

          headers: { "Content-Type": "application/json" },

          body: JSON.stringify({ text })

        }

      );



      const data = await response.json();

      aiResult.textContent = data.feedback || "AI returned no feedback.";



    } catch (err) {

      console.error(err);

      aiResult.textContent = "AI request failed. Check console.";

    }

  };

</script>



</body>

</html>
